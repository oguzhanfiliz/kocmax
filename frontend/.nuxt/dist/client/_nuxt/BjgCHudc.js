import{B as L,r as g,z as m,C as p,h as f}from"./3_Zv-WpX.js";const j=L("category",()=>{const u=g([]),v=g(null),c=g(!1),d=g(null),h=g({current_page:1,per_page:20,total:0,last_page:1}),A=m(()=>u.value.length>0),S=m(()=>u.value.filter(t=>!t.parent_id||t.level===0)),k=m(()=>u.value.filter(t=>t.children&&t.children.length>0)),C=g([]),y=g([]),w=g([]);return{categories:u,currentCategory:v,menuCategories:C,flatMenuCategories:y,featuredCategories:w,isLoading:c,error:d,meta:h,hasCategories:A,rootCategories:S,categoriesWithChildren:k,fetchCategories:async t=>{c.value=!0,d.value=null;try{const r=f(),l=r.isAuthenticated&&r.token||void 0,o={per_page:100,with_products:!0,...t},i=await p.getCategories(o,l),n=i.data.map(e=>({id:e.id,name:e.name,slug:e.slug||e.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),description:e.description,parent_id:e.parent_id,image:e.image||e.image_url,is_active:e.is_active!==!1,level:e.level||0,children:[],products_count:e.products_count||0,created_at:e.created_at,updated_at:e.updated_at})),a=new Map,s=[];return n.forEach(e=>{a.set(e.id,e),e.parent_id||s.push(e)}),n.forEach(e=>{if(e.parent_id&&a.has(e.parent_id)){const _=a.get(e.parent_id);_.children||(_.children=[]),_.children.push(e)}}),u.value=n,i.meta&&(h.value=i.meta),i}catch(r){throw d.value=r.message||"Failed to fetch categories",console.error("Failed to fetch categories:",r),r}finally{c.value=!1}},fetchCategoriesWithChildren:async()=>{c.value=!0,d.value=null;try{const t=f(),r=t.isAuthenticated&&t.token||void 0,l=await p.getCategories({per_page:200,with_products:!0},r),o=l.data.map(a=>({id:a.id,name:a.name,slug:a.slug||a.name.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,""),description:a.description,parent_id:a.parent_id,image:a.image||a.image_url,is_active:a.is_active!==!1,level:a.level||(a.parent_id?1:0),children:[],products_count:a.products_count||0,products:[],created_at:a.created_at,updated_at:a.updated_at})),i=new Map,n=[];return o.forEach(a=>{i.set(a.id,{...a,children:[],products:[]})}),o.forEach(a=>{const s=i.get(a.id);a.parent_id&&i.has(a.parent_id)?i.get(a.parent_id).children.push(s):n.push(s)}),await Promise.allSettled(Array.from(i.values()).map(async a=>{try{const s=await p.getProducts({category_id:a.id,per_page:10,currency:"TRY"},r);s!=null&&s.data&&s.data.length>0?(a.products=s.data.map(e=>({id:e.id,name:e.name,slug:e.slug||e.name.toLowerCase().replace(/\s+/g,"-"),price:typeof e.price=="object"?e.price.original:e.price||0,compare_price:typeof e.compare_price=="object"?e.compare_price.original:e.compare_price,currency:e.currency||"TRY",image:e.images&&e.images.length>0?e.images[0]:e.image,stock_quantity:e.stock_quantity||0,is_featured:e.is_featured||!1,is_active:e.is_active!==!1})),a.products_count=s.data.length):(a.products=[],a.products_count=0)}catch(s){console.error(`Failed to fetch products for category ${a.name}:`,s),a.products=[],a.products_count=0}})),u.value=Array.from(i.values()),l.meta&&(h.value=l.meta),console.log("Categories with hierarchy and products loaded:",{total:u.value.length,roots:n.length,withChildren:n.filter(a=>a.children&&a.children.length>0).length,withProducts:u.value.filter(a=>a.products&&a.products.length>0).length}),l}catch(t){throw d.value=t.message||"Failed to fetch categories with children",console.error("Failed to fetch categories with children:",t),t}finally{c.value=!1}},fetchMenuCategories:async t=>{c.value=!0,d.value=null;try{const r={};t!=null&&t.withChildren&&(r.with_children=1),t!=null&&t.includeNonRoot&&(r.include_non_root=1);const l=await p.getMenuCategories(r),i=(((l==null?void 0:l.data)??l)||[]).map(n=>{var a,s;return{id:n.id,name:n.name,slug:n.slug||((s=(a=n.name)==null?void 0:a.toLowerCase())==null?void 0:s.replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")),description:n.description,parent_id:n.parent_id,image:n.image_url||n.image,is_active:n.is_active!==!1,level:n.level??(n.parent_id?1:0),children:Array.isArray(n.children)?n.children.map(e=>{var _,F;return{id:e.id,name:e.name,slug:e.slug||((F=(_=e.name)==null?void 0:_.toLowerCase())==null?void 0:F.replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")),description:e.description,parent_id:e.parent_id,image:e.image_url||e.image,is_active:e.is_active!==!1,level:e.level??1,children:Array.isArray(e.children)?e.children:[],products_count:e.products_count||0,products:[],created_at:e.created_at||"",updated_at:e.updated_at||""}}):[],products_count:n.products_count||0,products:[],created_at:n.created_at||"",updated_at:n.updated_at||""}});return t!=null&&t.withChildren&&!(t!=null&&t.includeNonRoot)&&(C.value=i),t!=null&&t.includeNonRoot&&(y.value=i),i}catch(r){throw d.value=r.message||"Failed to fetch menu categories",console.error("Failed to fetch menu categories:",r),r}finally{c.value=!1}},fetchFeaturedCategories:async t=>{c.value=!0,d.value=null;try{const r=await p.getFeaturedCategories(t),o=(((r==null?void 0:r.data)??r)||[]).map(i=>{var n,a;return{id:i.id,name:i.name,slug:i.slug||((a=(n=i.name)==null?void 0:n.toLowerCase())==null?void 0:a.replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")),description:i.description,parent_id:i.parent_id,image:i.image_url||i.image,is_active:i.is_active!==!1,level:i.level??(i.parent_id?1:0),children:[],products_count:i.products_count||0,products:[],created_at:i.created_at||"",updated_at:i.updated_at||""}});return w.value=o,o}catch(r){throw d.value=r.message||"Failed to fetch featured categories",console.error("Failed to fetch featured categories:",r),r}finally{c.value=!1}},fetchCategory:async t=>{c.value=!0,d.value=null;try{const r=f(),l=r.isAuthenticated&&r.token||void 0,o=await p.getCategory(t,l);return v.value={id:o.data.id,name:o.data.name,slug:o.data.slug||o.data.name.toLowerCase().replace(/\s+/g,"-"),description:o.data.description,parent_id:o.data.parent_id,image:o.data.image,is_active:o.data.is_active!==!1,level:o.data.level||0,children:o.data.children||[],products_count:o.data.products_count||0,created_at:o.data.created_at,updated_at:o.data.updated_at},o}catch(r){throw d.value=r.message||"Failed to fetch category",console.error("Failed to fetch category:",r),r}finally{c.value=!1}},getCategoryBySlug:t=>u.value.find(r=>r.slug===t),getCategoriesByParent:t=>u.value.filter(r=>r.parent_id===t),clearError:()=>{d.value=null}}});export{j as u};
