{"version":3,"file":"_id_-DjHTNlkR.js","sources":["../../../../pages/product-details/[id].vue"],"sourcesContent":["<template>\r\n  <div>\r\n    <!-- Loading State -->\r\n    <div v-if=\"pending\" class=\"container py-5\">\r\n      <div class=\"text-center\">\r\n        <div class=\"spinner-border text-primary\" role=\"status\">\r\n          <span class=\"visually-hidden\">Yükleniyor...</span>\r\n        </div>\r\n        <p class=\"mt-3\">Ürün bilgileri yükleniyor...</p>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Error State -->\r\n    <div v-else-if=\"error && !product\" class=\"container py-5\">\r\n      <div class=\"text-center\">\r\n        <h2>Ürün Bulunamadı</h2>\r\n        <p class=\"text-muted\">Aradığınız ürün mevcut değil (ID: {{ productId }}) veya kaldırılmış olabilir.</p>\r\n        <nuxt-link href=\"/shop\" class=\"btn btn-primary\">Ürünleri Gör</nuxt-link>\r\n        <div class=\"mt-3 text-small text-muted\">\r\n          Hata detayı: {{ error.message || error }}\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n    <!-- Product Content -->\r\n    <div v-else-if=\"product && displayProduct\">\r\n        <!-- breadcrumb start -->\r\n        <product-details-breadcrumb :product=\"displayProduct\" />\r\n        <!-- breadcrumb end -->\r\n\r\n        <!-- product details area start -->\r\n        <product-details-area :product=\"displayProduct\" />\r\n        <!-- product details area end -->\r\n\r\n        <!-- related products start -->\r\n        <product-related :product-id=\"product.id\" :category=\"displayProduct.category.name\" />\r\n        <!-- related products end -->\r\n    </div>\r\n    \r\n    <!-- Fallback for unexpected states -->\r\n    <div v-else class=\"container py-5\">\r\n      <div class=\"text-center\">\r\n        <h3>Bir sorun oluştu</h3>\r\n        <p>Sayfa yükleniyor...</p>\r\n        <button @click=\"$router.go(0)\" class=\"btn btn-secondary\">Sayfayı Yenile</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup lang=\"ts\">\r\nimport { useProductStore } from '@/pinia/useProductStore';\r\nimport { type IProduct } from '@/types/product-type';\r\nimport { apiService } from '@/services/api';\r\n\r\nconst route = useRoute()\r\nconst productStore = useProductStore();\r\n\r\n// API Product interface\r\ninterface ApiProduct {\r\n  id: number;\r\n  name: string;\r\n  description: string;\r\n  sku: string;\r\n  price: {\r\n    original: number;\r\n    formatted: string;\r\n  };\r\n  images: Array<{\r\n    image_url: string;\r\n    is_primary: boolean;\r\n  }>;\r\n  variants?: Array<{\r\n    id: number;\r\n    color: string;\r\n    size: string;\r\n    stock: number;\r\n    price: number;\r\n    sku: string;\r\n  }>;\r\n  in_stock: boolean;\r\n  categories: Array<{\r\n    name: string;\r\n  }>;\r\n  brand?: string;\r\n}\r\n\r\nconst productId = computed(() => Number(route.params.id));\r\n\r\n// Geçici çözüm: Products listesinden ID'ye göre bul\r\n// TODO: Backend single product API düzeltilince apiService.getProduct kullan\r\nconst { data: product, pending, error } = await useLazyAsyncData(\r\n  `product-${productId.value}`,\r\n  async () => {\r\n    try {\r\n      // Önce single product API'yi dene\r\n      const singleProduct = await apiService.getProduct(productId.value, 'TRY');\r\n      return singleProduct.data as ApiProduct;\r\n    } catch (error) {\r\n      // Single product API çalışmıyorsa products listesinden bul\r\n      console.warn('Single product API failed, falling back to products list');\r\n      const productsResponse = await apiService.getProducts({ per_page: 100 });\r\n      const foundProduct = productsResponse.data.find((p: any) => p.id === productId.value);\r\n      \r\n      if (!foundProduct) {\r\n        throw new Error(`Product with ID ${productId.value} not found`);\r\n      }\r\n      \r\n      return foundProduct as ApiProduct;\r\n    }\r\n  },\r\n  {\r\n    key: `product-${productId.value}`,\r\n    server: false, // Client-side rendering için\r\n    default: () => null,\r\n    transform: (data) => data || null\r\n  }\r\n);\r\n\r\n// Convert API product to display format\r\nconst displayProduct = computed(() => {\r\n  if (!product.value) return null;\r\n  \r\n  const apiProduct = product.value;\r\n  \r\n  return {\r\n    id: apiProduct.id,\r\n    title: apiProduct.name,\r\n    description: apiProduct.description,\r\n    sku: apiProduct.sku,\r\n    price: apiProduct.price.original,\r\n    status: apiProduct.in_stock ? 'in-stock' : 'out-of-stock',\r\n    parent: apiProduct.categories?.[0]?.name || 'Genel',\r\n    category: {\r\n      name: apiProduct.categories?.[0]?.name || 'Genel'\r\n    },\r\n    reviews: [],\r\n    discount: 0,\r\n    imageURLs: processVariantsForColors(apiProduct.variants),\r\n    sizes: processVariantsForSizes(apiProduct.variants),\r\n    variants: apiProduct.variants || [],\r\n    img: getMainImage(apiProduct.images),\r\n    // Add missing IProduct fields\r\n    slug: apiProduct.name.toLowerCase().replace(/\\s+/g, '-'),\r\n    unit: 'adet',\r\n    children: '',\r\n    quantity: 1,\r\n    brand: { name: apiProduct.brand || '' },\r\n    productType: '',\r\n    additionalInformation: [],\r\n    sellCount: 0,\r\n    featured: false,\r\n    tags: [],\r\n    offerDate: undefined,\r\n    videoId: undefined\r\n  } as IProduct;\r\n});\r\n\r\n// Process variants to extract unique colors\r\nfunction processVariantsForColors(variants?: Array<any>) {\r\n  if (!variants || variants.length === 0) return [];\r\n  \r\n  const colorMap = new Map();\r\n  variants.forEach(variant => {\r\n    if (variant.color && !colorMap.has(variant.color)) {\r\n      colorMap.set(variant.color, {\r\n        color: {\r\n          name: variant.color,\r\n          clrCode: getColorCode(variant.color)\r\n        },\r\n        img: getMainImage(product.value?.images) // Use main product image\r\n      });\r\n    }\r\n  });\r\n  \r\n  return Array.from(colorMap.values());\r\n}\r\n\r\n// Process variants to extract unique sizes\r\nfunction processVariantsForSizes(variants?: Array<any>) {\r\n  if (!variants || variants.length === 0) return [];\r\n  \r\n  const sizesSet = new Set();\r\n  variants.forEach(variant => {\r\n    if (variant.size) {\r\n      sizesSet.add(variant.size);\r\n    }\r\n  });\r\n  \r\n  return Array.from(sizesSet).sort();\r\n}\r\n\r\n// Get main product image\r\nfunction getMainImage(images?: Array<any>): string {\r\n  if (!images || images.length === 0) return '';\r\n  \r\n  const primaryImage = images.find(img => img.is_primary);\r\n  return primaryImage?.image_url || images[0]?.image_url || '';\r\n}\r\n\r\n// Get color hex codes\r\nfunction getColorCode(colorName: string): string {\r\n  const colorCodes: Record<string, string> = {\r\n    'Siyah': '#000000',\r\n    'Gri': '#808080',\r\n    'Beyaz': '#FFFFFF',\r\n    'Mavi': '#0066CC',\r\n    'Kırmızı': '#CC0000',\r\n    'Yeşil': '#006600',\r\n    'Sarı': '#FFCC00',\r\n    'Turuncu': '#FF6600',\r\n    'Mor': '#6600CC',\r\n    'Pembe': '#FF69B4'\r\n  };\r\n  return colorCodes[colorName] || '#CCCCCC';\r\n}\r\n\r\n// Set SEO meta tags based on product\r\nwatch(displayProduct, (newProduct) => {\r\n  if (newProduct) {\r\n    useSeoMeta({\r\n      title: `${newProduct.title} | Shofy`,\r\n      description: newProduct.description.substring(0, 160),\r\n      ogTitle: `${newProduct.title} | Shofy`,\r\n      ogDescription: newProduct.description.substring(0, 160),\r\n      ogImage: newProduct.img,\r\n      ogType: 'product',\r\n    });\r\n  }\r\n}, { immediate: true });\r\n\r\n// Set active image when product loads\r\nwatch(product, (newProduct) => {\r\n  if (newProduct && newProduct.images?.length > 0) {\r\n    const mainImage = getMainImage(newProduct.images);\r\n    if (mainImage) {\r\n      productStore.activeImg = mainImage;\r\n    }\r\n  }\r\n}, { immediate: true });\r\n\r\n// Handle 404 for invalid product IDs\r\nwatch(error, (newError) => {\r\n  if (newError) {\r\n    console.error('Product loading error:', newError);\r\n    // Don't throw error in client-side, show error message instead\r\n  }\r\n});\r\n\r\n// Debug: Log the current product ID and error state\r\nwatch([productId, error], ([id, err]) => {\r\n  if (process.client) {\r\n    console.log('Product ID:', id);\r\n    if (err) {\r\n      console.error('Product Error:', err.message || 'Unknown error');\r\n    }\r\n  }\r\n});\r\n\r\n</script>\r\n\r\n<style scoped>\r\n.spinner-border {\r\n  width: 3rem;\r\n  height: 3rem;\r\n}\r\n\r\n.text-center {\r\n  text-align: center;\r\n}\r\n\r\n.container {\r\n  max-width: 1200px;\r\n  margin: 0 auto;\r\n  padding: 0 15px;\r\n}\r\n\r\n.py-5 {\r\n  padding: 3rem 0;\r\n}\r\n\r\n.mt-3 {\r\n  margin-top: 1rem;\r\n}\r\n\r\n.text-muted {\r\n  color: #6c757d;\r\n}\r\n\r\n.btn {\r\n  display: inline-block;\r\n  padding: 0.5rem 1rem;\r\n  margin-bottom: 0;\r\n  font-size: 1rem;\r\n  font-weight: 400;\r\n  line-height: 1.5;\r\n  text-align: center;\r\n  text-decoration: none;\r\n  vertical-align: middle;\r\n  cursor: pointer;\r\n  border: 1px solid transparent;\r\n  border-radius: 0.375rem;\r\n  transition: color 0.15s ease-in-out, background-color 0.15s ease-in-out;\r\n}\r\n\r\n.btn-primary {\r\n  color: #fff;\r\n  background-color: #0989ff;\r\n  border-color: #0989ff;\r\n}\r\n\r\n.btn-primary:hover {\r\n  background-color: #0056b3;\r\n  border-color: #0056b3;\r\n}\r\n</style>"],"names":["_withAsyncContext","error","_unref","_push","_parent","_ssrRenderComponent"],"mappings":"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"}