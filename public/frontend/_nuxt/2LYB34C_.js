import{B as z,r as m,z as y,C as _}from"./3_Zv-WpX.js";const A=z("currency",()=>{const l=m([]),o=m(null),s=m(null),d=m([]),u=m(!1),i=m(null),F=y(()=>l.value.filter(e=>e.is_active)),R=y(()=>{var e,a;return((e=o.value)==null?void 0:e.code)||((a=s.value)==null?void 0:a.code)||"TRY"}),S=y(()=>{var e,a;return((e=o.value)==null?void 0:e.symbol)||((a=s.value)==null?void 0:a.symbol)||"â‚º"}),C=async(e=!0)=>{u.value=!0,i.value=null;try{const a=await _.getCurrencies({active_only:e}),r=(a==null?void 0:a.data)??a;l.value=(r||[]).map(t=>({id:t.id,name:t.name,code:t.code,symbol:t.symbol,rate:t.rate||1,is_default:t.is_default||!1,is_active:t.is_active!==!1,decimal_places:t.decimal_places||2,position:t.position||"before",created_at:t.created_at||"",updated_at:t.updated_at||""}));const c=l.value.find(t=>t.is_default);c&&(s.value=c);const n=localStorage.getItem("selectedCurrency");if(n){const t=l.value.find(f=>f.code===n);t&&(o.value=t)}else c&&(o.value=c);return l.value}catch(a){throw i.value=a.message||"Failed to fetch currencies",console.error("Failed to fetch currencies:",a),a}finally{u.value=!1}},w=async()=>{u.value=!0,i.value=null;try{const e=await _.getDefaultCurrency(),a=(e==null?void 0:e.data)??e;return a&&(s.value={id:a.id,name:a.name,code:a.code,symbol:a.symbol,rate:a.rate||1,is_default:!0,is_active:a.is_active!==!1,decimal_places:a.decimal_places||2,position:a.position||"before",created_at:a.created_at||"",updated_at:a.updated_at||""},o.value||(o.value=s.value)),s.value}catch(e){throw i.value=e.message||"Failed to fetch default currency",console.error("Failed to fetch default currency:",e),e}finally{u.value=!1}},h=async()=>{u.value=!0,i.value=null;try{const e=await _.getExchangeRates(),a=(e==null?void 0:e.data)??e;return a&&a.rates?d.value=Object.entries(a.rates).map(([r,c])=>({from:a.base_currency||"TRY",to:r,rate:Number(c),updated_at:a.last_updated||""})):d.value=[],d.value}catch(e){i.value=e.message||"Failed to fetch exchange rates",console.error("Failed to fetch exchange rates:",e),d.value=[]}finally{u.value=!1}},E=e=>{o.value=e,localStorage.setItem("selectedCurrency",e.code)},p=(e,a,r)=>{var b,x;const c=a||((b=s.value)==null?void 0:b.code)||"TRY",n=r||((x=o.value)==null?void 0:x.code)||"TRY";if(c===n)return e;const t=d.value.find(v=>v.from===c&&v.to===n);if(t)return e*t.rate;const f=l.value.find(v=>v.code===c),g=l.value.find(v=>v.code===n);return f&&g?e/f.rate*g.rate:e};return{currencies:l,currentCurrency:o,defaultCurrency:s,exchangeRates:d,isLoading:u,error:i,activeCurrencies:F,currentCurrencyCode:R,currentCurrencySymbol:S,fetchCurrencies:C,fetchDefaultCurrency:w,fetchExchangeRates:h,setCurrency:E,convertPrice:p,formatPrice:(e,a)=>{var t;const r=a?l.value.find(f=>f.code===a):o.value;if(!r)return e.toString();const n=p(e,(t=s.value)==null?void 0:t.code,r.code).toFixed(r.decimal_places||2);return r.position==="after"?`${n} ${r.symbol}`:`${r.symbol} ${n}`},initializeCurrencies:async()=>{if(l.value.length===0&&!u.value)try{await Promise.all([C(!0),h()])}catch(e){console.error("Error initializing currencies:",e)}},clearError:()=>{i.value=null}}});export{A as u};
